<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Grain LifeCycle | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Grain LifeCycle | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2.5.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="docfx:rel" content="../../">
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h2 id="grains-lifecycle" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="7" sourceendlinenumber="7">Grains LifeCycle</h2>
              
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="9" sourceendlinenumber="14">We say grains virtually always exist but here we want to describe different stages of a grain&#39;s life.
A grain is like a class definition, it is nothing unless it is on the memory and can execute code.
An instance of a class is instantiated with the <code>new</code> keyword in C#.
an instance of a grain is called an activation.
The grain&#39;s instances are differentiated by their key and a grain with a specific key is either activated or not.
You don&#39;t control this by using construction/destruction keywords and instead Orleans runtime manages this for you.</p>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="16" sourceendlinenumber="19">All possible grains in the whole key space virtually always exist
and it means whenever you call a method of a grain, if it is not active, it will get activated by the runtime.
Also after the grain passes a certain amount of time in idle state, the runtime will deactivate the grain (i.e. destroys it).
A grain is in idle state if it is not currently processing a message and its cueue of messages is empty.</p>
<h2 id="callbacks" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="21" sourceendlinenumber="21">callbacks</h2>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="23" sourceendlinenumber="24">Just like the class which can have constructors and (destructors in some languages), grains have
<code>OnActivateAsync</code> and <code>OnDeactivateAsync</code> virtual methods which you can override.</p>
<h2 id="different-grain-types-and-their-differences-regarding-life-cycle" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="26" sourceendlinenumber="26">Different grain types and their differences regarding life cycle</h2>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="28" sourceendlinenumber="31">Your grains can be persistent and store their state in storage
or have no state which is stored in storage. 
In case of the later, all activations are created equal and there is no difference between them.
For grains which store their state and derive from <code>Grain&lt;T&gt;</code> there is a point which you should consider.</p>
<blockquote sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="33" sourceendlinenumber="33"><p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="33" sourceendlinenumber="33"><code>ReadStateAsync</code> is called before calling <code>OnActivateAsync</code> and if it fails then the grain will not be activated.</p>
</blockquote>
<h2 id="sequence-of-events-in-a-grains-life-cycle" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="36" sourceendlinenumber="36">Sequence of events in a grain&#39;s life cycle</h2>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="38" sourceendlinenumber="38">So the life cycle of a grain is like this</p>
<ul sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="40" sourceendlinenumber="47">
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="40" sourceendlinenumber="40">another grain or a client calls a method of a grain</li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="41" sourceendlinenumber="43">the grain gets activated and brought to memory<ul sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="42" sourceendlinenumber="43">
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="42" sourceendlinenumber="42">the grain state will be read from storage if any</li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="43" sourceendlinenumber="43">if successful then <code>OnActivateAsync</code> is called</li>
</ul>
</li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="44" sourceendlinenumber="44">The grain will process some messages</li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="45" sourceendlinenumber="45">The grain remains idle for some time</li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="46" sourceendlinenumber="46">Runtime will call <code>OnDeactivateAsync</code></li>
<li sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="47" sourceendlinenumber="47">Runtime removes the grain from memory</li>
</ul>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="49" sourceendlinenumber="50">Now if a Silo gets a shutdown request gracefully, the message cueues of all activated grains will be forwarded to another silo with the grain activation,
but if a silo crashes, <code>OnDeactivateAsync</code> will not be called so you can not rely on it to store state for fault tolerance unless you can live with losing some state.</p>
<h2 id="next" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="52" sourceendlinenumber="52">Next</h2>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="53" sourceendlinenumber="53">Next we look at how easy it is to debug our Orleans application</p>
<p sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="55" sourceendlinenumber="55"><a href="Debugging.html" sourcefile="Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md" sourcestartlinenumber="55" sourceendlinenumber="55">Debugging</a></p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/orleans/blob/gh-pages/src/Documentation/Getting-Started-With-Orleans/Grain-LifeCycle.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
