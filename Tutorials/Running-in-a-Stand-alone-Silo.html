<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Running in a Stand-Alone Silo | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Running in a Stand-Alone Silo | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2.9.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta property="docfx:rel" content="../">
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <h1 id="running-in-a-stand-alone-silo">Running in a Stand-Alone Silo</h1>
              
<p>In the <a href="My-First-Orleans-Application.html">first tutorial</a>, we got a very simple &quot;Hello World!&quot; Orleans application running in the simplest possible environment, a dev/test host where everything is running in one process, which makes starting and stopping it really easy.
For most of your initial development of grain-based applications and services, that environment will be ideal.</p>
<p>However, one thing that is hard to test in such an environment is what happens when the client and server do not get started and stopped at the same time.
Often, state is maintained on the server across client sessions, something that is hard to model using the single-process setup.</p>
<p>Therefore, what we&#39;re going to do now is modify the solution we finished up with in the first tutorial and make it just a bit more like a production environment, running the server and client code in different processes.</p>
<h2 id="getting-started">Getting Started</h2>
<p>The first thing we need to do is get the grain code running in a silo that is in a separate process and prevent it from being started by the code in <em>Program.cs</em>.</p>
<p>To do the latter, remove the code that starts the silo in its own app domain, as well as the code that shuts it down at the end.</p>
<p>One consequence of not running the silo from the same process is that the client code has to wait for the silo to be ready to accept incoming requests.
Rather than adding some clever backoff-retry code, here we simply expect you to wait for the silo to start, then hit &#39;Enter&#39; in the client console window when the silo is advertising its readiness.</p>
<p> This is the result:</p>
<pre><code class="lang-csharp">static void Main(string[] args)
{
    Console.WriteLine(&quot;Waiting for Orleans Silo to start. Press Enter to proceed...&quot;);
    Console.ReadLine();

    // Orleans comes with a rich XML and programmatic configuration. Here we&#39;re just going to set up with basic programmatic config
    var config = Orleans.Runtime.Configuration.ClientConfiguration.LocalhostSilo(30000);

    GrainClient.Initialize(config);
}
</code></pre><p>Now you should add reference to Microsoft.Orleans.Server NuGet package to your collection project and then in its project properties in Debug tab set the bin/Debug/OrleansHost.exe or bin/Release/OrleansHost.exe file as startup program for your collections class library. Try to not mix NuGet package versions, make sure all Orlean packages (client, graininterface and grain projects) are aligned in the solution.</p>
<p>You also need to add a OrleansConfiguration.xml file, you can create it using the instruction in <a href="Minimal-Orleans-Application.html">Minimal Orleans Application tutorial</a>. Then, in this file, make sure that the <code>ProxyingGateway</code> element inside its Defaults section matches this value:</p>
<pre><code class="lang-xml">&lt;ProxyingGateway Address=&quot;localhost&quot; Port=&quot;30000&quot; /&gt;
</code></pre><p>OrleansHost.exe is a ready-made host executable intended for running Orleans silo code. It is also useful for development purposes. If you set both the grain collection project and the the host project as startup projects, you will see two windows come up:</p>
<p><img src="../Images/Standalone%201.PNG" alt=""></p>
<p>This allows us to debug the grains in their own process, while keeping the client code in its own process.
If you let the client make its request, then terminate it using &#39;Enter&#39; when asked, you should see only the client process windows disappear.
The debugging session won&#39;t end, because the grains are still being debugged in the <em>OrleansHost.exe</em> process.
To start the client again, you will have to use the right-button context menu in the Solution Explorer to get it started.</p>
<h2 id="keeping-things-around">Keeping Things Around</h2>
<p>To demonstrate keeping state around across client sessions, let&#39;s modify the <code>SayHello()</code> method to take a string argument.
Then, we will have our grain save each string it is sent and return the last one.
Only at the first greeting will we see something we didn&#39;t send to the grain from the client.</p>
<p>First, change the interface definition of SayHello</p>
<pre><code class="lang-csharp">public interface IGrain1 : IGrainWithIntegerKey
{
    Task&lt;string&gt; SayHello(string greeting);
}
</code></pre><p>Then change the Implementation</p>
<pre><code class="lang-csharp">private string text = &quot;Hello World!&quot;;

public Task&lt;string&gt; SayHello(string greeting)
{
    var oldText = text;
    text = greeting;
    return Task.FromResult(oldText);
}
</code></pre><p> We also change the client to send a greeting several times in Program.cs:</p>
<pre><code class="lang-csharp">var hello = GrainClient.GrainFactory.GetGrain&lt;IGrain1&gt;(0);
Console.WriteLine(hello.SayHello(&quot;First&quot;).Result);
Console.WriteLine(hello.SayHello(&quot;Second&quot;).Result);
Console.WriteLine(hello.SayHello(&quot;Third&quot;).Result);
Console.WriteLine(hello.SayHello(&quot;Fourth&quot;).Result);
</code></pre><p>What we would expect to see here is four greetings, the first of which is &quot;Hello World!&quot;.
Let&#39;s check it out:</p>
<p><img src="../Images/Standalone%202.PNG" alt=""></p>
<p>Terminate the client (make sure it&#39;s just the client, we need the grain host to stay up) and restart it using the context menu.
There&#39;s no reason to wait for the silo now, since it&#39;s already running.
Here&#39;s what we get:</p>
<p><img src="../Images/Standalone%203.PNG" alt=""></p>
<p>Still four greetings, but instead of &quot;Hello World!&quot; the first greeting is the last one from our previous client session.
In other words, the grain in the silo kept some state around for us.</p>
<h2 id="next">Next</h2>
<p>So far, we&#39;ve only seen one single grain type and a single instance of that type.
It has served to keep things simple for the purpose of explaining how the environment works, but it is not typical of Orleans code.
In the next tutorial, we will see something more realistic.</p>
<p><a href="Actor-Identity.html">Actor Identity</a></p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
