<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Client Configuration | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Client Configuration | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<div class="IMPORTANT"><h5>Important</h5><p><strong>You are looking at the 1.5 documentation</strong></p>
<p>Orleans 2.0 is a significant overhaul from the 1.x versions.
For 2.0 <a href="/Documentation/Introduction.html">Documentation</a> and <a href="/Tutorials/index.html">Tutorials</a>, refer to the respective sections.</p>
</div>
<h1 id="client-configuration">Client Configuration</h1>
<p>The key parameter that has to be configured for a client is the silo’s client gateway endpoint(s) to connect to. There are two ways to do that: manually configure one or more gateway endpoints or point the client to the Azure Table used by silos’ cluster membership. In the latter case the client automatically discovers what silos with client gateways enabled are available within the deployment, and adjusts its connections to the gateways as they join or leave the cluster. This option is reliable and recommended for production deployment.</p>
<h2 id="fixed-gateway-configuration">Fixed Gateway Configuration</h2>
<p>A fixed set of gateways is specified in the ClientConfiguration.xml with one or more Gateway nodes:</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Gateway Address=&quot;gateway1&quot; Port=&quot;30000&quot;/&gt;
  &lt;Gateway Address=&quot;gateway2&quot; Port=&quot;30000&quot;/&gt;
  &lt;Gateway Address=&quot;gateway3&quot; Port=&quot;30000&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p> One gateway is generally enough. Multiple gateway connections help increase throughput and reliability of the system.</p>
<h2 id="gateway-configuration-based-on-cluster-membership">Gateway Configuration Based on Cluster Membership</h2>
<p>To configure the client to automatically find gateways from the silo cluster membership table, you need to specify the Azure Table or SQL Server connection string and the target deployment ID.</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;SystemStore SystemStoreType=&quot;AzureTable&quot;
               DeploymentId=&quot;target deployment ID&quot;
               DataConnectionString=&quot;Azure storage connection string&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p> or</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;SystemStore SystemStoreType=&quot;SqlServer&quot;
               DeploymentId=&quot;target deployment ID&quot;
               DataConnectionString=&quot;SQL connection string&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p> or</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;SystemStore SystemStoreType=&quot;ZooKeeper&quot;
               DeploymentId=&quot;target deployment ID&quot;
               DataConnectionString=&quot;ZooKeeper connection string&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><h2 id="local-silo">Local Silo</h2>
<p>For the local development/test configuration that uses a local silo, the client gateway should be configured to &#39;localhost.&#39;</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Gateway Address=&quot;localhost&quot; Port=&quot;30000&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><h2 id="web-role-client-in-azure">Web Role Client in Azure</h2>
<p>When the client is a web role running inside the same Azure deployment as the silo worker roles, all gateway address information is read from the OrleansSiloInstances table when OrleansAzureClient.Initialize() is called. The Azure storage connection string used to find the correct OrleansSiloInstances table is specified in the &quot;DataConnectionString&quot; setting defined in the service configuration for the deployment &amp; role.</p>
<pre><code class="lang-xml">&lt;ServiceConfiguration  ...&gt;
  &lt;Role name=&quot;WebRole&quot;&gt; ...
    &lt;ConfigurationSettings&gt;
      &lt;Setting name=&quot;DataConnectionString&quot; value=&quot;DefaultEndpointsProtocol=https;AccountName=MYACCOUNTNAME;AccountKey=MYACCOUNTKEY&quot; /&gt;
    &lt;/ConfigurationSettings&gt;
  &lt;/Role&gt;
  ...
&lt;/ServiceConfiguration&gt;
</code></pre><p>Both the silo worker roles and web client roles need to be use the same Azure storage account in order to successfully discover each other successfully.</p>
<p>When using OrleansAzureClient.Initialize() and OrleansSiloInstances table for gateway address discovery, no additional gateway address info in required in the client config file. Typically the ClientConfiguration.xml file will only contain some minimal debug / tracing configuration settings, although even that is not required.</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Tracing DefaultTraceLevel=&quot;Info&quot; &gt;
    &lt;TraceLevelOverride LogPrefix=&quot;Application&quot; TraceLevel=&quot;Info&quot; /&gt;
  &lt;/Tracing&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p>Code-based client configuration. This is a reference only example and SHOULD NOT be used AS-IS - you may need to fine-tune client parameters for your specific environment.</p>
<pre><code class="lang-csharp">var dataConnection = &quot;DefaultEndpointsProtocol=https;AccountName=MYACCOUNTNAME;AccountKey=MYACCOUNTKEY&quot;;

var config = new ClientConfiguration
{
    // Some top level features
    GatewayProvider = ClientConfiguration.GatewayProviderType.AzureTable,
    ResponseTimeout = TimeSpan.FromSeconds(30),
    DeploymentId = RoleEnvironment.DeploymentId,
    DataConnectionString = dataConnection,
    PropagateActivityId = true,

    // Tracing
    DefaultTraceLevel = Severity.Info,
    TraceToConsole = false,
    TraceFilePattern = @&quot;Client_{0}-{1}.log&quot;,
    //TraceFilePattern = &quot;false&quot;, // Set it to false or none to disable file tracing, effectively it sets config.Defaults.TraceFileName = null;

    TraceLevelOverrides =
    {
        Tuple.Create(&quot;ComponentName&quot;, Severity.Warning),
    }
};

config.RegisterStreamProvider&lt;AzureQueueStreamProvider&gt;(&quot;AzureQueueStreams&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;PubSubType&quot;, &quot;ExplicitGrainBasedAndImplicit&quot; },
        { &quot;DeploymentId&quot;, &quot;orleans-streams&quot; }, // This will be a prefix name of your Queues - so be careful and use string that is valid for queue name
        { &quot;NumQueues&quot;, &quot;4&quot; },
        { &quot;GetQueueMessagesTimerPeriod&quot;, &quot;100ms&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

config.RegisterStreamProvider&lt;SimpleMessageStreamProvider&gt;(&quot;SimpleMessagingStreams&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;PubSubType&quot;, &quot;ExplicitGrainBasedAndImplicit&quot; }
    });

IClusterClient client = null;
while (true)
{
    try
    {
        // Build a client and then connect it to the cluster.
        client = new ClientBuilder()
            .UseConfiguration(config)
            .ConfigureServices(
                services =&gt;
                {
                    // Services can be provided to the client here. These services are made
                    // available via dependency injection.
                    // ConfigureServices can be called multiple times for a single
                    // ClientBuilder instance.
                })
            .Build();

        // Connect the client to the cluster. Once connection succeeds, the client will
        // maintain the connection, automatically reconnecting as necessary.
        await client.Connect().ConfigureAwait(false);
        break;
    }
    catch (Exception exception)
    {
        // If the connection attempt fails, the client instance must be disposed.
        client?.Dispose();

        // TODO: Log the exception.
        // TODO: Add a counter to break up an infinite cycle (circuit breaker pattern).
        await Task.Delay(TimeSpan.FromSeconds(5));
    }
}

// Use the client.
// Note that clients can be shared between threads and are typically long-lived.
var user client.GetGrain&lt;IUserGrain&gt;(&quot;leeroy77jenkins@battle.net&quot;);
Console.WriteLine(await user.GetProfile());
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/orleans/blob/gh-pages/src/1.5/Documentation/Deployment-and-Operations/Configuration-Guide/Client-Configuration.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
