<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Typical Configurations | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Typical Configurations | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<div class="IMPORTANT"><h5>Important</h5><p><strong>You are looking at the 1.5 documentation</strong></p>
<p>Orleans 2.0 is a significant overhaul from the 1.x versions.
For 2.0 <a href="/orleans/Documentation/Introduction.html">Documentation</a> and <a href="/orleans/Tutorials/index.html">Tutorials</a>, refer to the respective sections.</p>
</div>
<h1 id="typical-configurations">Typical Configurations</h1>
<p>Below are examples of typical configurations that can be used for development and production deployments.</p>
<h2 id="local-development">Local Development</h2>
<p>For local development, where there is only one silo running locally on the programmer’s machine, the configuration is already included in the <em>Orleans Dev/Test Host</em> project template of <a href="https://marketplace.visualstudio.com/items?itemName=sbykov.MicrosoftOrleansToolsforVisualStudio">Microsoft Orleans Tools for Visual Studio</a>. The local silo that can be started by running a project created with the <em>Orleans Dev/Test Host</em> template is configured as follows in DevTestServerConfiguration.xml.</p>
<pre><code class="lang-xml">&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;SeedNode Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Networking Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
    &lt;ProxyingGateway Address=&quot;localhost&quot; Port=&quot;30000&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p>Silo configuration via code is as follows.</p>
<pre><code class="lang-c#">var config = ClusterConfiguration.LocalhostPrimarySilo(11111, 30000);
</code></pre><p>To connect to the local silo, the client needs to be configured to localhost and can only connect from the same machine. The Orleans client that can be started by running a project created with the <em>Orleans Dev/Test Host</em> template is configured as follows in DevTestClientConfiguration.xml</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Gateway Address=&quot;localhost&quot; Port=&quot;30000&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p>Client configuration via code is as follows.</p>
<pre><code class="lang-c#">var config = ClientConfiguration.LocalhostSilo(30000);
</code></pre><h2 id="reliable-production-deployment-using-azure">Reliable Production Deployment Using Azure</h2>
<p>For a reliable production deployment using Azure, you need to use the Azure Table option for cluster membership. This configuration is typical of deployments to either on-premise servers or Azure virtual machine instances.</p>
<p> The format of the DataConnection string is &quot;DefaultEndpointsProtocol=https;AccountName=<azure storage="" account="">;AccountKey=<azure table="" storage="" account="" key="">&quot;<p>
<pre><code class="lang-xml">&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;SystemStore SystemStoreType=&quot;AzureTable&quot;
         DeploymentId=&quot;&lt;your deployment ID&gt;&quot;
         DataConnectionString=&quot;&lt;&lt;see comment above&gt;&gt;&quot; /&gt;
    &lt;Liveness LivenessType =&quot;AzureTable&quot; /&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Networking Address=&quot;&quot; Port=&quot;11111&quot; /&gt;
    &lt;ProxyingGateway Address=&quot;&quot; Port=&quot;30000&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p>Clients need to be configured to use Azure Table for discovering the gateways, the addresses of the Orleans servers are not statically known to the clients.</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;SystemStore SystemStoreType=&quot;AzureTable&quot; DeploymentId=&quot;target deployment ID&quot; DataConnectionString=&quot;&lt;&lt;see comment above&gt;&gt;&quot; /&gt;
&lt;/ClientConfiguration&gt;
</code></pre><h2 id="reliable-production-deployment-using-zookeeper">Reliable Production Deployment Using ZooKeeper</h2>
<p>For a reliable production deployment using ZooKeeper, you need to use the ZooKeeper option for cluster membership. This configuration is typical of deployments to on-premise servers.</p>
<p> The format of the DataConnection string is documented in the <a href="http://zookeeper.apache.org/doc/r3.4.6/zookeeperProgrammers.html#ch_zkSessions">ZooKeeper Programmer&#39;s Guide</a>. A minimum of 5 ZooKeeper servers is <a href="http://zookeeper.apache.org/doc/r3.4.6/zookeeperAdmin.html#sc_zkMulitServerSetup">recommended</a>.</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;SystemStore SystemStoreType=&quot;ZooKeeper&quot;
                   DeploymentId=&quot;&lt;your deployment ID&gt;&quot;
                   DataConnectionString=&quot;&lt;&lt;see comment above&gt;&gt;&quot;/&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Networking Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
    &lt;ProxyingGateway Address=&quot;localhost&quot; Port=&quot;30000&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p>Clients need to be configured to use ZooKeeper for discovering the gateways, the addresses of the Orleans servers are not statically known to the clients.</p>
<pre><code class="lang-xml">﻿&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;SystemStore SystemStoreType=&quot;ZooKeeper&quot; DeploymentId=&quot;target deployment ID&quot; DataConnectionString=&quot;&lt;&lt;see comment above&gt;&gt;&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><h2 id="reliable-production-deployment-using-sql-server">Reliable Production Deployment Using SQL Server</h2>
<p>For a reliable production deployment using SQL server, a SQL server connection string needs to be supplied.</p>
<p>Silo configuration via code is as follows, and includes logging configuration.</p>
<pre><code class="lang-c#">var connectionString = @&quot;Data Source=MSSQLDBServer;Initial Catalog=Orleans;Integrated Security=True;
    Max Pool Size=200;Asynchronous Processing=True;MultipleActiveResultSets=True&quot;;

var config = new ClusterConfiguration{    
    Globals =    
    {
        DataConnectionString = connectionString,
        DeploymentId = &quot;&lt;your deployment ID&gt;&quot;,

        LivenessType = GlobalConfiguration.LivenessProviderType.SqlServer,
        LivenessEnabled = true,
        ReminderServiceType = GlobalConfiguration.ReminderServiceProviderType.SqlServer
    },
    Defaults =
    {        
        Port = 11111,
        ProxyGatewayEndpoint = new IPEndPoint(address, 30000),
        PropagateActivityId = true
    }};

var siloHost = new SiloHost(System.Net.Dns.GetHostName(), config);
</code></pre><p>Clients need to be configured to use SQL server for discovering the gateways, as with Azure and Zookeeper, the addresses of the Orleans servers are not statically known to the clients.</p>
<pre><code class="lang-c#">
var connectionString = @&quot;Data Source=MSSQLDBServer;Initial Catalog=Orleans;Integrated Security=True;
    Max Pool Size=200;Asynchronous Processing=True;MultipleActiveResultSets=True&quot;;

var config = new ClientConfiguration{
    GatewayProvider = ClientConfiguration.GatewayProviderType.SqlServer,
    AdoInvariant = &quot;System.Data.SqlClient&quot;,
    DataConnectionString = connectionString,

    DeploymentId = &quot;&lt;your deployment ID&gt;&quot;,    
    PropagateActivityId = true
};

var client = new ClientBuilder().UseConfiguration(config).Build();
await client.Connect();
</code></pre><h2 id="unreliable-deployment-on-a-cluster-of-dedicated-servers">Unreliable Deployment on a Cluster of Dedicated Servers</h2>
<p>For testing on a cluster of dedicated servers when reliability isn’t a concern you can leverage MembershipTableGrain and avoid dependency on Azure Table. You just need to designate one of the nodes as a Primary.</p>
<pre><code class="lang-xml">&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;SeedNode Address=&quot;&lt;primary node&gt;&quot; Port=&quot;11111&quot; /&gt;
    &lt;Liveness LivenessType =&quot;MembershipTableGrain&quot; /&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Networking Address=&quot; &quot; Port=&quot;11111&quot; /&gt;
    &lt;ProxyingGateway Address=&quot; &quot; Port=&quot;30000&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p> For the client:</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Gateway Address=&quot;node-1&quot; Port=&quot;30000&quot;/&gt;
  &lt;Gateway Address=&quot;node-2&quot; Port=&quot;30000&quot;/&gt;
  &lt;Gateway Address=&quot;node-3&quot; Port=&quot;30000&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><h2 id="azure-worker-role-deployment">Azure Worker Role Deployment</h2>
<p>When Orleans is deployed into an Azure Worker role, as opposed to VM instances, most of the server-side configuration is actually done in files other than the OrleansConfiguration, which looks something like this:</p>
<pre><code class="lang-xml">&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;Liveness LivenessType=&quot;AzureTable&quot; /&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Tracing DefaultTraceLevel=&quot;Info&quot; TraceToConsole=&quot;true&quot; TraceToFile=&quot;{0}-{1}.log&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p> Some information is kept in the service configuration file, in which the worker role section looks like this:</p>
<pre><code class="lang-xml">&lt;Role name=&quot;OrleansAzureSilos&quot;&gt;
  &lt;Instances count=&quot;2&quot; /&gt;
  &lt;ConfigurationSettings&gt;
    &lt;Setting name=&quot;DataConnectionString&quot; value=&quot;&lt;&lt;see earlier comment&gt;&gt;&quot; /&gt;
    &lt;Setting name=&quot;Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString&quot; value=&quot;&lt;&lt;see earlier comment&gt;&gt;&quot; /&gt;
  &lt;/ConfigurationSettings&gt;
&lt;/Role&gt;
</code></pre><p>The data connection string and the diagnostics connection string do not have to be the same.</p>
<p>Some configuration information is kept in the service definition file. The worker role has to be configured there, too:</p>
<pre><code class="lang-xml">&lt;WorkerRole name=&quot;OrleansAzureSilos&quot; vmsize=&quot;Large&quot;&gt;
  &lt;Imports&gt;
    &lt;Import moduleName=&quot;Diagnostics&quot; /&gt;
  &lt;/Imports&gt;
  &lt;ConfigurationSettings&gt;
    &lt;Setting name=&quot;DataConnectionString&quot; /&gt;
  &lt;/ConfigurationSettings&gt;
  &lt;LocalResources&gt;
    &lt;LocalStorage name=&quot;LocalStoreDirectory&quot; cleanOnRoleRecycle=&quot;false&quot; /&gt;
  &lt;/LocalResources&gt;
  &lt;Endpoints&gt;
    &lt;InternalEndpoint name=&quot;OrleansSiloEndpoint&quot; protocol=&quot;tcp&quot; port=&quot;11111&quot; /&gt;
    &lt;InternalEndpoint name=&quot;OrleansProxyEndpoint&quot; protocol=&quot;tcp&quot; port=&quot;30000&quot; /&gt;
  &lt;/Endpoints&gt;
&lt;/WorkerRole&gt;
</code></pre><p>That&#39;s it for the worker role hosting the Orleans runtime. However, when deploying to Azure, there is typically a front end of some sort, either a web site or a web service, since making the Orleans ports public is not a good idea. Therefore, the client configuration is configuration of the web or worker role (or web site) that sits in front of Orleans.</p>
<p><strong>Important Note</strong> As of November 2017, there is a limitation in Azure Cloud Services which prevents firewall configuration of <code>InternalEndpoint</code>s if there is only 1 role in the Cloud Service. If you are connecting to your cloud service via a Virtual Network, you will have to scale your Cloud Services to two instances in order for the firewall rules to be created</p>
<p> Assuming that the frontend is a web role, a simple ClientConfiguration file should be used:</p>
<pre><code class="lang-xml">&lt;ClientConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Tracing DefaultTraceLevel=&quot;Info&quot;
           TraceToConsole=&quot;true&quot;
           TraceToFile=&quot;{0}-{1}.log&quot;
           WriteTraces=&quot;false&quot;/&gt;
&lt;/ClientConfiguration&gt;
</code></pre><p> The web role needs the same connection string information as the worker role, in the service configuration file:</p>
<pre><code class="lang-xml">&lt;Role name=&quot;WebRole&quot;&gt;
  &lt;Instances count=&quot;2&quot; /&gt;
  &lt;ConfigurationSettings&gt;
    &lt;Setting name=&quot;DataConnectionString&quot; value=&quot;&lt;&lt;see earlier comment&gt;&gt;&quot; /&gt;
    &lt;Setting name=&quot;Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString&quot; value=&quot;&lt;&lt;see earlier comment&gt;&gt;&quot; /&gt;
  &lt;/ConfigurationSettings&gt;
&lt;/Role&gt;
</code></pre><p> and in the service definition file:</p>
<pre><code class="lang-xml">&lt;WebRole name=&quot;WebRole&quot; vmsize=&quot;Large&quot;&gt;
  &lt;Imports&gt;
    &lt;Import moduleName=&quot;Diagnostics&quot; /&gt;
  &lt;/Imports&gt;
  &lt;ConfigurationSettings&gt;
    &lt;Setting name=&quot;DataConnectionString&quot; /&gt;
  &lt;/ConfigurationSettings&gt;
  &lt;!-- There is additional web role data that has nothing to do with Orleans --&gt;
&lt;/WebRole&gt;
</code></pre></azure></azure></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/orleans/blob/gh-pages/src/1.5/Documentation/Deployment-and-Operations/Configuration-Guide/Typical-Configurations.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
