<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Server Configuration | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Server Configuration | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="server-configuration">Server Configuration</h1>

<p>There are two key aspects of silo configuration:</p>
<ul>
<li>Connectivity: silo’s endpoints for other silos and clients</li>
<li>Cluster membership and reliability: how silos discover each other in a deployment and detect node failures.</li>
</ul>
<p>Depending on the environment you want to run Orleans in some of these parameters may or may not be important.
For example, for a single silo development environment one usually doesn’t need reliability, and all the endpoints can be localhost.</p>
<p>The following sections detail the configuration setting for the four mentioned key aspects.
Then in the scenarios section you can find the recommended combinations of the settings for the most typical deployment scenarios.</p>
<h2 id="connectivity">Connectivity</h2>
<p>The connectivity settings define two TCP/IP endpoints: one for inter-silo communication and one for client connections, also referred to as client gateway or simply gateway.</p>
<p><strong>Inter-silo Endpoint</strong></p>
<pre><code class="lang-xml">&lt;Networking Address=&quot; &quot; Port=&quot;11111&quot; /&gt;
</code></pre><p> Address: IP address or host name to use. If left empty, silo will pick the first available IPv4 address. Orleans supports IPv6 as well as IPv4.</p>
<p> Port: TCP port to use. If left empty, silo will pick a random available port. If there is only one silo running on the machine, it is advisable to specify a port for consistency and for easy configuration of the firewall. For running multiple silos on the same machine, you can either provide each of the silos with different configuration files or leave the Port attribute empty for a random port assignment.</p>
<p> For machines that have more than one IP address assigned to them, if you need to choose an address from a specific subnet or an IPv6 address, you can do that by adding a Subnet and PreferredFamily attributes respectively (refer to the XSD schema for exact syntax of those attributes).</p>
<p> For local development environment, you can simply use localhost as the host name:</p>
<pre><code class="lang-xml">&lt;Networking Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
</code></pre><h2 id="client-gateway-endpoint">Client Gateway Endpoint</h2>
<p> The setting for client gateway endpoint is identical to the inter-silo endpoint except for the XML element name:</p>
<pre><code class="lang-xml">&lt;ProxyingGateway Address=&quot;localhost&quot; Port=&quot;30000&quot; /&gt;
</code></pre><p> You have to specify a port number different from the one used for the inter-silo endpoint.</p>
<p> It is possible to configure clients to connect to the inter-silo endpoint instead of the gateway, but that requires opening a listening socket on the client (thus requires enabling incoming connections on the client machine firewall), and in general is not advisable other than for a very limited set of scenarios.</p>
<h2 id="cluster-membership-and-reliability">Cluster Membership and Reliability</h2>
<p> Usually, a service built on Orleans is deployed on a cluster of nodes, either on dedicated hardware or in Azure. For development and basic testing, Orleans can be deployed in a single node configuration. When deployed to a cluster of nodes, Orleans internally implements a set of protocols to discover and maintain membership of Orleans silos in the cluster, including detection of node failures and automatic reconfiguration.</p>
<p> For reliable management of cluster membership, Orleans uses Azure Table, SQL Server or Apache ZooKeeper for synchronization of nodes. The reliable membership setup requires configuring the &#39;SystemStore&#39; element settings in the silo configuration file:</p>
<pre><code class="lang-xml">&lt;SystemStore SystemStoreType=&quot;AzureTable&quot;
             DeploymentId=&quot;...&quot;
             DataConnectionString=&quot;...&quot;/&gt;
</code></pre><p> or</p>
<pre><code class="lang-xml">&lt;SystemStore SystemStoreType=&quot;SqlServer&quot;
             DeploymentId=&quot;...&quot;
             DataConnectionString=&quot;...&quot;/&gt;
</code></pre><p> or</p>
<pre><code class="lang-xml">&lt;SystemStore SystemStoreType=&quot;ZooKeeper&quot;
             DeploymentId=&quot;...&quot;
             DataConnectionString=&quot;...&quot;/&gt;
</code></pre><p> DeploymentId is a unique string that defines a particular deployment. When deploying an Orleans based service to Azure it makes most sense to use the Azure deployment ID of the worker role.</p>
<p> For development or if it’s not possible to use Azure Table, silos can be configured to use the membership grain instead. Such a configuration is unreliable as it will not survive a failure of the primary silo that hosts the membership grain. “MembershipTableGrain” is the default value of LivenessType.</p>
<pre><code class="lang-xml">&lt;Liveness LivenessType =&quot;MembershipTableGrain&quot; /&gt;
</code></pre><h2 id="primary-silo">Primary Silo</h2>
<p>In a reliable deployment, one that is configured with membership using Azure Table, SQL Server or ZooKeeper, all silos are created equal, with no notion of primary or secondary silos. That is the configuration that is recommended for production that will survive a failure of any individual node or a combination of nodes. For example, Azure periodically rolls out OS patches and that causes all of the role instances to reboot eventually.</p>
<p> For development or a non-reliable deployment when MembershipTableGrain is used, one of the silos has to be designated as Primary and has to start and initialize before other, Secondary, silos that wait for Primary to initialize before joining the cluster. In case of a failure of the Primary node, the whole deployment stops working properly and has to be restarted.</p>
<p>Primary is designated in the configuration file with the following setting within the Globals section.</p>
<pre><code class="lang-xml">&lt;SeedNode Address=&quot;&lt;host name or IP address of the primary node&gt;&quot; Port=&quot;11111&quot; /&gt;
</code></pre><p>Here is an example how to configure and launch Orleans silo hosted inside worker-role.
This is a reference only example and SHOULD NOT be used AS-IS - you may need to fine-tune client parameters for your specific environment.</p>
<pre><code class="lang-csharp">var dataConnection = &quot;DefaultEndpointsProtocol=https;AccountName=MYACCOUNTNAME;AccountKey=MYACCOUNTKEY&quot;;

var config = new ClusterConfiguration
{
    Globals =
    {
        DeploymentId = RoleEnvironment.DeploymentId,
        ResponseTimeout = TimeSpan.FromSeconds(30),
        DataConnectionString = dataConnection,

        LivenessType = GlobalConfiguration.LivenessProviderType.AzureTable,
        ReminderServiceType = GlobalConfiguration.ReminderServiceProviderType.AzureTable,
    },
    Defaults =
    {
        PropagateActivityId = true,

        // Tracing
        DefaultTraceLevel = Severity.Info,
        TraceToConsole = false,
        TraceFilePattern = @&quot;Silo_{0}-{1}.log&quot;,
        //TraceFilePattern = &quot;false&quot;, // Set it to false or none to disable file tracing, effectively it sets config.Defaults.TraceFileName = null;
        TraceLevelOverrides =
        {
            Tuple.Create(&quot;ComponentName&quot;, Severity.Warning),
        }
    }
};

// Register bootstrap provider class
config.Globals.RegisterBootstrapProvider&lt;AutoStartBootstrapProvider&gt;(&quot;MyAutoStartBootstrapProvider&quot;);

// Add Storage Providers
config.Globals.RegisterStorageProvider&lt;MemoryStorage&gt;(&quot;MemoryStore&quot;);

config.Globals.RegisterStorageProvider&lt;AzureTableStorage&gt;(&quot;PubSubStore&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;DeleteStateOnClear&quot;, &quot;true&quot; },
        //{ &quot;UseJsonFormat&quot;, &quot;true&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

config.Globals.RegisterStorageProvider&lt;AzureTableStorage&gt;(&quot;AzureTable&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;DeleteStateOnClear&quot;, &quot;true&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

config.Globals.RegisterStorageProvider&lt;AzureTableStorage&gt;(&quot;DataStorage&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;DeleteStateOnClear&quot;, &quot;true&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

config.Globals.RegisterStorageProvider&lt;BlobStorageProvider&gt;(&quot;BlobStorage&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;DeleteStateOnClear&quot;, &quot;true&quot; },
        { &quot;ContainerName&quot;, &quot;grainstate&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

// Add Stream Providers
config.Globals.RegisterStreamProvider&lt;AzureQueueStreamProvider&gt;(&quot;AzureQueueStreams&quot;,
    new Dictionary&lt;string, string&gt;
    {
        { &quot;PubSubType&quot;, &quot;ExplicitGrainBasedAndImplicit&quot; },
        { &quot;DeploymentId&quot;, &quot;orleans-streams&quot; },
        { &quot;NumQueues&quot;, &quot;4&quot; },
        { &quot;GetQueueMessagesTimerPeriod&quot;, &quot;100ms&quot; },
        { &quot;DataConnectionString&quot;, dataConnection }
    });

try
{
    _orleansAzureSilo = new AzureSilo();
    var ok = _orleansAzureSilo.Start(config, config.Globals.DeploymentId, config.Globals.DataConnectionString);

    _orleansAzureSilo.Run(); // Call will block until silo is shutdown
}
catch (Exception exc)
{
    //Log &quot;Error when starting Silo&quot;
}
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/orleans/blob/gh-pages/src/1.5/Documentation/Deployment-and-Operations/Configuration-Guide/Server-Configuration.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
