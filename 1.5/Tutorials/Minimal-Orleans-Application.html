<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Minimal Orleans Application | Microsoft Orleans Website </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Minimal Orleans Application | Microsoft Orleans Website ">
    <meta name="generator" content="docfx 2">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../Images/logo-light.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="minimal-orleans-application">Minimal Orleans Application</h1>

<p>This tutorial provides step by step instructions for creating a basic functioning Orleans application. It is designed to be self-contained and minimalistic, with the following traits.</p>
<ul>
<li>It does not need the SDK or Extension to be installed, and relies on Nuget packages only.</li>
<li>Has been tested in both Visual Studio 2013 and 2015 using Orleans 1.2.0.</li>
<li>Has no reliance on SQL or Azure</li>
</ul>
<p>Keep in mind that this is only a tutorial and lacks appropriate error handling and other goodies that would be useful for a production environment. However, it should help the readers get a real hands-on with regards to different facets of Orleans and allow them to focus their continued learning on the parts most relevant to them.</p>
<p>You can find the final source code in <code>Samples\Tutorial.Minimal</code> folder (<a href="https://github.com/dotnet/orleans/tree/master/Samples/Tutorial.Minimal">see latest version online</a>).</p>
<h2 id="project-setup">Project Setup</h2>
<p>For this tutorial we’re going to need to create 3 projects.  A Library that contains the interfaces (Communication interfaces), a library that contains the implementation (called Grains), and a simple console application that will Host our Silo.  For further understanding of this terminology please see the document <a href="My-First-Orleans-Application.html">Getting Started with Orleans</a>.</p>
<p>The Solution will eventually look like this.  (Missing files will be added in the sections below)</p>
<p><img src="../Images/MinimalOrleansApplication1.png" alt=""></p>
<h4 id="within-visual-studio">Within Visual Studio</h4>
<ol>
<li>Create a blank solution called OrleansTest</li>
<li>Create a New Console Application called Host</li>
<li>Create a New class library called GrainInterfaces</li>
<li>Create a New class library called GrainCollection</li>
</ol>
<p>We just use the default project types in c#.</p>
<h4 id="delete-the-extras">Delete the Extras</h4>
<ol>
<li>Delete Class1.cs from GrainCollection</li>
<li>Delete Class1.cs from GrainInterfaces</li>
</ol>
<h4 id="add-the-following-references">Add the following References</h4>
<ol>
<li>GrainCollection references GrainInterfaces</li>
<li>Host references GrainInterfaces</li>
<li>Host references GrainCollection</li>
</ol>
<h2 id="adding-orleans">Adding Orleans</h2>
<p>Orleans is available via Nuget.  The primary goodness is in Microsoft.Orleans.Core but we will be including packages that provide additional functionality.  Specifically, we will be using Template packages, which provide autocode generation for our grains and interfaces, and the Runtime which is used for hosting.</p>
<h4 id="with-nuget">With Nuget</h4>
<ol>
<li>Add Microsoft.Orleans.OrleansCodeGenerator.Build  to GrainInterfaces</li>
<li>Add Microsoft.Orleans.OrleansCodeGenerator.Build  to GrainCollection</li>
<li>Add Microsoft.Orleans.OrleansRuntime to Host</li>
</ol>
<h2 id="creating-our-grain-interface">Creating our Grain Interface</h2>
<p>In GrainInterfaces create an interface IHello.cs</p>
<pre><code class="lang-csharp">
public interface IHello : Orleans.IGrainWithIntegerKey
{
    Task&lt;string&gt; SayHello(string msg);
}
</code></pre><h2 id="creating-our-implementation">Creating our Implementation</h2>
<p>In GrainCollection create a class  HelloGrain.cs</p>
<pre><code class="lang-csharp">
class HelloGrain : Orleans.Grain, IHello
{
    public Task&lt;string&gt; SayHello(string msg)
    {
        return Task.FromResult(string.Format(&quot;You said {0}, I say: Hello!&quot;, msg));
    }
}
</code></pre><h2 id="host">Host</h2>
<p>The host requires the most amount of attention to get Orleans up and running. Throughout future tutorials, much of this will change, or go away (Orleans comes with a nice precanned SiloHost and the extension provides a template that simplifies this).</p>
<p>However this small implementation should demonstrate the basics of getting started.</p>
<h4 id="host--appconfig">Host – App.Config</h4>
<p>Change App.config to enable the recommended server garbage collection</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;configuration&gt;
  &lt;runtime&gt;
    &lt;gcServer enabled=&quot;true&quot;/&gt;
    &lt;gcConcurrent enabled=&quot;true&quot;/&gt;
  &lt;/runtime&gt;
&lt;/configuration&gt;
</code></pre><h4 id="host--orleansconfigurationxml">Host – OrleansConfiguration.xml</h4>
<p>Within the Host project, add an XML file named OrleansConfiguration.xml. This will be used for cluster configuration. </p>
<p>Make sure to set the <em>Copy to Output directory</em> file property to <em>Copy if newer</em>:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;OrleansConfiguration xmlns=&quot;urn:orleans&quot;&gt;
  &lt;Globals&gt;
    &lt;SeedNode Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
  &lt;/Globals&gt;
  &lt;Defaults&gt;
    &lt;Networking Address=&quot;localhost&quot; Port=&quot;11111&quot; /&gt;
    &lt;ProxyingGateway Address=&quot;localhost&quot; Port=&quot;30000&quot; /&gt;
  &lt;/Defaults&gt;
&lt;/OrleansConfiguration&gt;
</code></pre><p>It is possible to configure this within the code, but it is fairly difficult to do so.</p>
<h4 id="host--programcs">Host – Program.cs</h4>
<p>Program.cs is our lengthiest code block. We attempt to accomplish a number of objectives here</p>
<ol>
<li>Initialize Orleans in its own AppDomain</li>
<li>Run a trivial task (DoSomeClientWork)</li>
<li>Wait for the user to press enter</li>
<li>Shutdown gracefully</li>
</ol>
<p>The Orleans samples come with a very nice class called HostWrapper, which abstracts some of the boiler plate within this example and is worth exploring for a more robust implementation. We&#39;re going to do this by hand in this tutorial.</p>
<pre><code class="lang-csharp">using Orleans.Runtime.Host;
using Orleans;
using System.Net;
using System;


class Program
{

    static SiloHost siloHost;

    static void Main(string[] args)
    {
        // Orleans should run in its own AppDomain, we set it up like this
        AppDomain hostDomain = AppDomain.CreateDomain(&quot;OrleansHost&quot;, null,
            new AppDomainSetup()
            {
                AppDomainInitializer = InitSilo
            });


        DoSomeClientWork();

        Console.WriteLine(&quot;Orleans Silo is running.\nPress Enter to terminate...&quot;);
        Console.ReadLine();

        // We do a clean shutdown in the other AppDomain
        hostDomain.DoCallBack(ShutdownSilo);
    }


    static void DoSomeClientWork()
    {
        // Orleans comes with a rich XML and programmatic configuration. Here we&#39;re just going to set up with basic programmatic config
        var config = Orleans.Runtime.Configuration.ClientConfiguration.LocalhostSilo(30000);
        GrainClient.Initialize(config);

        var friend = GrainClient.GrainFactory.GetGrain&lt;IHello&gt;(0);
        var result = friend.SayHello(&quot;Goodbye&quot;).Result;
        Console.WriteLine(result);

    }

    static void InitSilo(string[] args)
    {
        siloHost = new SiloHost(System.Net.Dns.GetHostName());
        // The Cluster config is quirky and weird to configure in code, so we&#39;re going to use a config file
        siloHost.ConfigFileName = &quot;OrleansConfiguration.xml&quot;;

        siloHost.InitializeOrleansSilo();
        var startedok = siloHost.StartOrleansSilo();
        if (!startedok)
            throw new SystemException(String.Format(&quot;Failed to start Orleans silo &#39;{0}&#39; as a {1} node&quot;, siloHost.Name, siloHost.Type));

    }

    static void ShutdownSilo()
    {
        if (siloHost != null)
        {
            siloHost.Dispose();
            GC.SuppressFinalize(siloHost);
            siloHost = null;
        }
    }

}
</code></pre><h2 id="running-the-application">Running the application</h2>
<p>At this point we should be able to run the Host project. A console should appear with a large amount of logging text, and at the end it should look like this</p>
<p><img src="../Images/MinimalOrleansApplication2.png" alt=""></p>
<p>Within the appropriate bin directory (Debug/Release) there will be a number of log files showing this information as well.  The amount and method of logging is configurable.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
<li>System.SystemException: &#39;Failed to start Orleans silo &#39;YOUR-HOST-NAME&#39; as a Secondary node&#39;:<ul>
<li>Problem: The silo is trying to start but does not find a the specified file to get the configuration.</li>
<li>Solution: Set the property &quot;Copy to Output Directory&quot; to &quot;Copy if newer&quot;, to set it, right click on the configuration file, then click on properties.
```</li>
</ul>
</li>
</ul>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="http://dotnet.github.io/orleans/Documentation/Installation/NuGets.html">List of Orleans Packages</a></li>
<li><a href="http://dotnet.github.io/orleans/Documentation/Orleans-Configuration-Guide/">Orleans Configuration Guide</a></li>
<li><a href="https://www.microsoft.com/en-us/research/publication/orleans-best-practices">Orleans Best Practices</a></li>
<li><a href="Running-in-a-Stand-alone-Silo.html">Running in a Stand Alone Silo</a></li>
<li><a href="http://dotnet.github.io/orleans/Documentation/Samples-Overview/Azure-Web-Sample">Azure Web Sample</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/orleans/blob/gh-pages/src/1.5/Tutorials/Minimal-Orleans-Application.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
